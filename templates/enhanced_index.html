<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>NBA Props Analyzer Pro - Advanced Betting Intelligence</title>
    <link href="https://cdn.jsdelivr.net/npm/tailwindcss@2.2.19/dist/tailwind.min.css" rel="stylesheet">
    <link href="{{ url_for('static', filename='css/enhanced_style.css') }}" rel="stylesheet">
    <script src="https://cdn.jsdelivr.net/npm/chart.js@3.9.1/dist/chart.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/alpinejs@3.x.x/dist/cdn.min.js" defer></script>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
</head>
<body class="bg-gray-900 text-white min-h-screen" x-data="nbaPropsApp()">
    <!-- Navigation -->
    <nav class="bg-gradient-to-r from-blue-900 to-purple-900 shadow-lg">
        <div class="container mx-auto px-4">
            <div class="flex justify-between items-center py-4">
                <div class="flex items-center">
                    <i class="fas fa-basketball-ball text-orange-500 text-3xl mr-3"></i>
                    <h1 class="text-2xl font-bold bg-gradient-to-r from-orange-400 to-red-500 bg-clip-text text-transparent">
                        NBA Props Analyzer Pro
                    </h1>
                </div>
                <div class="flex space-x-4">
                    <button @click="activeTab = 'analyzer'" 
                            :class="{'bg-blue-600': activeTab === 'analyzer', 'bg-gray-700': activeTab !== 'analyzer'}"
                            class="px-4 py-2 rounded-lg transition-all hover:bg-blue-600">
                        <i class="fas fa-chart-line mr-2"></i>Analyzer
                    </button>
                    <button @click="activeTab = 'bankroll'" 
                            :class="{'bg-blue-600': activeTab === 'bankroll', 'bg-gray-700': activeTab !== 'bankroll'}"
                            class="px-4 py-2 rounded-lg transition-all hover:bg-blue-600">
                        <i class="fas fa-wallet mr-2"></i>Bankroll
                    </button>
                    <button @click="activeTab = 'parlay'" 
                            :class="{'bg-blue-600': activeTab === 'parlay', 'bg-gray-700': activeTab !== 'parlay'}"
                            class="px-4 py-2 rounded-lg transition-all hover:bg-blue-600">
                        <i class="fas fa-layer-group mr-2"></i>Parlays
                    </button>
                    <button @click="activeTab = 'analytics'" 
                            :class="{'bg-blue-600': activeTab === 'analytics', 'bg-gray-700': activeTab !== 'analytics'}"
                            class="px-4 py-2 rounded-lg transition-all hover:bg-blue-600">
                        <i class="fas fa-chart-bar mr-2"></i>Analytics
                    </button>
                </div>
            </div>
        </div>
    </nav>

    <!-- Main Content -->
    <div class="container mx-auto px-4 py-8">
        
        <!-- Prop Analyzer Tab -->
        <div x-show="activeTab === 'analyzer'" class="space-y-6">
            <!-- Enhanced Analysis Form -->
            <div class="bg-gray-800 rounded-xl shadow-2xl p-6">
                <h2 class="text-2xl font-bold mb-6 text-center">
                    <i class="fas fa-search mr-2 text-blue-400"></i>
                    Advanced Prop Analysis
                </h2>
                
                <div class="grid grid-cols-1 lg:grid-cols-2 gap-6">
                    <!-- Player Search -->
                    <div class="space-y-4">
                        <div class="relative">
                            <label class="block text-sm font-medium text-gray-300 mb-2">Player</label>
                            <div class="relative">
                                <input type="text" 
                                       id="playerSearch" 
                                       x-model="playerSearch"
                                       @input="searchPlayers()"
                                       class="w-full p-3 bg-gray-700 border border-gray-600 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-blue-500 text-white" 
                                       placeholder="Type player name..."
                                       autocomplete="off">
                                <div class="absolute inset-y-0 right-0 flex items-center pr-3">
                                    <i class="fas fa-search text-gray-400"></i>
                                </div>
                            </div>
                            <div x-show="playerSuggestions.length > 0" 
                                 class="absolute z-50 w-full mt-1 bg-gray-700 border border-gray-600 rounded-lg shadow-lg max-h-60 overflow-auto">
                                <template x-for="player in playerSuggestions" :key="player.id">
                                    <div @click="selectPlayer(player)" 
                                         class="px-4 py-2 cursor-pointer hover:bg-gray-600 text-white">
                                        <span x-text="player.full_name"></span>
                                        <span class="text-xs text-gray-400 ml-2" x-show="!player.is_active">(Inactive)</span>
                                    </div>
                                </template>
                            </div>
                        </div>

                        <!-- Prop Type and Line -->
                        <div class="grid grid-cols-2 gap-4">
                            <div>
                                <label class="block text-sm font-medium text-gray-300 mb-2">Prop Type</label>
                                <select x-model="selectedPropType" class="w-full p-3 bg-gray-700 border border-gray-600 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500 text-white">
                                    <option value="">Select Prop</option>
                                    <option value="points">Points</option>
                                    <option value="assists">Assists</option>
                                    <option value="rebounds">Rebounds</option>
                                    <option value="steals">Steals</option>
                                    <option value="blocks">Blocks</option>
                                    <option value="turnovers">Turnovers</option>
                                    <option value="three_pointers">3-Pointers Made</option>
                                    <option value="double_double">Double-Double</option>
                                    <option value="triple_double">Triple-Double</option>
                                    <option value="pts_reb">Points + Rebounds</option>
                                    <option value="pts_ast">Points + Assists</option>
                                    <option value="ast_reb">Assists + Rebounds</option>
                                    <option value="pts_ast_reb">Pts + Ast + Reb</option>
                                </select>
                            </div>
                            <div>
                                <label class="block text-sm font-medium text-gray-300 mb-2">Line</label>
                                <input type="number" 
                                       x-model="propLine" 
                                       step="0.5" 
                                       class="w-full p-3 bg-gray-700 border border-gray-600 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500 text-white" 
                                       placeholder="Enter line">
                            </div>
                        </div>
                    </div>

                    <!-- Opponent Team -->
                    <div class="space-y-4">
                        <div>
                            <label class="block text-sm font-medium text-gray-300 mb-2">Opponent Team</label>
                            <select x-model="opponentTeamId" class="w-full p-3 bg-gray-700 border border-gray-600 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500 text-white">
                                <option value="">Select Opponent</option>
                                <option value="1610612737">Atlanta Hawks</option>
                                <option value="1610612738">Boston Celtics</option>
                                <option value="1610612751">Brooklyn Nets</option>
                                <option value="1610612766">Charlotte Hornets</option>
                                <option value="1610612741">Chicago Bulls</option>
                                <option value="1610612739">Cleveland Cavaliers</option>
                                <option value="1610612742">Dallas Mavericks</option>
                                <option value="1610612743">Denver Nuggets</option>
                                <option value="1610612765">Detroit Pistons</option>
                                <option value="1610612744">Golden State Warriors</option>
                                <option value="1610612745">Houston Rockets</option>
                                <option value="1610612754">Indiana Pacers</option>
                                <option value="1610612746">LA Clippers</option>
                                <option value="1610612747">Los Angeles Lakers</option>
                                <option value="1610612763">Memphis Grizzlies</option>
                                <option value="1610612748">Miami Heat</option>
                                <option value="1610612749">Milwaukee Bucks</option>
                                <option value="1610612750">Minnesota Timberwolves</option>
                                <option value="1610612740">New Orleans Pelicans</option>
                                <option value="1610612752">New York Knicks</option>
                                <option value="1610612760">Oklahoma City Thunder</option>
                                <option value="1610612753">Orlando Magic</option>
                                <option value="1610612755">Philadelphia 76ers</option>
                                <option value="1610612756">Phoenix Suns</option>
                                <option value="1610612757">Portland Trail Blazers</option>
                                <option value="1610612758">Sacramento Kings</option>
                                <option value="1610612759">San Antonio Spurs</option>
                                <option value="1610612761">Toronto Raptors</option>
                                <option value="1610612762">Utah Jazz</option>
                                <option value="1610612764">Washington Wizards</option>
                            </select>
                        </div>

                        <!-- Analysis Options -->
                        <div class="space-y-2">
                            <label class="flex items-center space-x-2">
                                <input type="checkbox" x-model="includeSituational" class="rounded bg-gray-700 border-gray-600 text-blue-600 focus:ring-blue-500">
                                <span class="text-sm">Include Situational Analysis</span>
                                <i class="fas fa-info-circle text-blue-400 cursor-help" title="Analyze revenge games, milestones, rest advantages"></i>
                            </label>
                        </div>
                    </div>
                </div>

                <div class="mt-6 text-center">
                    <button @click="analyzeProp()" 
                            :disabled="isAnalyzing || !selectedPlayer || !selectedPropType || !propLine || !opponentTeamId"
                            :class="{'opacity-50 cursor-not-allowed': isAnalyzing || !selectedPlayer || !selectedPropType || !propLine || !opponentTeamId}"
                            class="bg-gradient-to-r from-blue-600 to-purple-600 hover:from-blue-700 hover:to-purple-700 text-white font-bold py-3 px-8 rounded-lg shadow-lg transform transition-all hover:scale-105">
                        <i x-show="!isAnalyzing" class="fas fa-chart-line mr-2"></i>
                        <i x-show="isAnalyzing" class="fas fa-spinner fa-spin mr-2"></i>
                        <span x-text="isAnalyzing ? 'Analyzing...' : 'Analyze Prop'"></span>
                    </button>
                </div>
            </div>

            <!-- Analysis Results -->
            <div x-show="analysisResults" class="bg-gray-800 rounded-xl shadow-2xl p-6">
                <h3 class="text-xl font-bold mb-4">
                    <i class="fas fa-chart-pie mr-2 text-green-400"></i>
                    Analysis Results
                </h3>
                
                <div class="grid grid-cols-1 lg:grid-cols-3 gap-6">
                    <!-- Main Prediction -->
                    <div class="lg:col-span-2">
                        <div class="bg-gray-700 rounded-lg p-4 mb-4">
                            <div class="flex justify-between items-center mb-4">
                                <h4 class="font-semibold text-lg">
                                    <span x-text="selectedPlayer?.full_name"></span> - 
                                    <span x-text="selectedPropType"></span> 
                                    <span x-text="propLine"></span>
                                </h4>
                                <div class="text-right">
                                    <div class="text-2xl font-bold" :class="getConfidenceColor(analysisResults?.confidence_score)">
                                        <span x-text="analysisResults?.confidence_score || 0"></span>%
                                    </div>
                                    <div class="text-sm text-gray-400">Confidence</div>
                                </div>
                            </div>

                            <!-- Recommendation -->
                            <div class="mb-4">
                                <div class="flex items-center justify-between p-3 rounded-lg" :class="getRecommendationColor(analysisResults?.enhanced_metrics?.final_recommendation)">
                                    <div class="flex items-center">
                                        <i class="fas fa-thumbs-up mr-2"></i>
                                        <span class="font-bold text-lg" x-text="analysisResults?.enhanced_metrics?.final_recommendation || 'PASS'"></span>
                                    </div>
                                    <div class="text-right">
                                        <div class="font-semibold">
                                            <span x-text="Math.round((analysisResults?.over_probability || 0.5) * 100)"></span>% Over
                                        </div>
                                        <div class="text-sm">Probability</div>
                                    </div>
                                </div>
                            </div>

                            <!-- Key Metrics -->
                            <div class="grid grid-cols-2 md:grid-cols-4 gap-4 mb-4">
                                <div class="bg-gray-600 p-3 rounded-lg text-center">
                                    <div class="font-bold text-lg" x-text="analysisResults?.predicted_value?.toFixed(1) || '0'"></div>
                                    <div class="text-xs text-gray-400">Predicted</div>
                                </div>
                                <div class="bg-gray-600 p-3 rounded-lg text-center">
                                    <div class="font-bold text-lg" x-text="analysisResults?.average?.toFixed(1) || '0'"></div>
                                    <div class="text-xs text-gray-400">Season Avg</div>
                                </div>
                                <div class="bg-gray-600 p-3 rounded-lg text-center">
                                    <div class="font-bold text-lg" x-text="analysisResults?.last5_average?.toFixed(1) || '0'"></div>
                                    <div class="text-xs text-gray-400">Last 5 Avg</div>
                                </div>
                                <div class="bg-gray-600 p-3 rounded-lg text-center">
                                    <div class="font-bold text-lg" x-text="analysisResults?.hit_rate ? (analysisResults.hit_rate * 100).toFixed(1) + '%' : '0%'"></div>
                                    <div class="text-xs text-gray-400">Hit Rate</div>
                                </div>
                            </div>
                        </div>

                        <!-- Situational Analysis -->
                        <div x-show="analysisResults?.situational_analysis" class="bg-gray-700 rounded-lg p-4">
                            <h5 class="font-semibold mb-3">
                                <i class="fas fa-lightning-bolt mr-2 text-yellow-400"></i>
                                Situational Factors
                            </h5>
                            
                            <div class="grid grid-cols-1 md:grid-cols-2 gap-4 text-sm">
                                <!-- Revenge Game -->
                                <div x-show="analysisResults?.situational_analysis?.revenge_game?.is_revenge_game" class="bg-red-600 bg-opacity-20 border border-red-500 rounded p-2">
                                    <i class="fas fa-fire mr-1"></i>
                                    Revenge Game vs Former Team!
                                </div>
                                
                                <!-- Milestones -->
                                <div x-show="analysisResults?.situational_analysis?.milestones?.active_milestones?.length > 0" class="bg-blue-600 bg-opacity-20 border border-blue-500 rounded p-2">
                                    <i class="fas fa-trophy mr-1"></i>
                                    <span x-text="'Chasing: ' + (analysisResults?.situational_analysis?.milestones?.active_milestones?.join(', ') || '')"></span>
                                </div>
                                
                                <!-- Rest Advantage -->
                                <div x-show="analysisResults?.situational_analysis?.rest_advantage?.advantage_level !== 'None'" class="bg-green-600 bg-opacity-20 border border-green-500 rounded p-2">
                                    <i class="fas fa-bed mr-1"></i>
                                    <span x-text="analysisResults?.situational_analysis?.rest_advantage?.advantage_level + ' Rest Advantage'"></span>
                                </div>

                                <!-- Overall Situation -->
                                <div class="bg-purple-600 bg-opacity-20 border border-purple-500 rounded p-2">
                                    <i class="fas fa-star mr-1"></i>
                                    Situation Grade: <span x-text="analysisResults?.situational_analysis?.situation_grade || 'D'"></span>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Bankroll Management -->
                    <div>
                        <div class="bg-gray-700 rounded-lg p-4">
                            <h5 class="font-semibold mb-3">
                                <i class="fas fa-calculator mr-2 text-green-400"></i>
                                Bankroll Recommendation
                            </h5>
                            
                            <div class="space-y-3 text-sm">
                                <div class="flex justify-between">
                                    <span>Recommended Units:</span>
                                    <span class="font-bold text-green-400" x-text="analysisResults?.bankroll_management?.recommended_units || 0"></span>
                                </div>
                                <div class="flex justify-between">
                                    <span>Bet Amount:</span>
                                    <span class="font-bold" x-text="'$' + (analysisResults?.bankroll_management?.recommended_amount || 0)"></span>
                                </div>
                                <div class="flex justify-between">
                                    <span>Risk Level:</span>
                                    <span class="font-bold" :class="getRiskColor(analysisResults?.bankroll_management?.risk_level)" x-text="analysisResults?.bankroll_management?.risk_level || 'HIGH'"></span>
                                </div>
                                <div class="flex justify-between">
                                    <span>Kelly %:</span>
                                    <span x-text="((analysisResults?.bankroll_management?.kelly_fraction || 0) * 100).toFixed(2) + '%'"></span>
                                </div>
                                <div class="flex justify-between">
                                    <span>Bankroll %:</span>
                                    <span x-text="(analysisResults?.bankroll_management?.bankroll_percentage || 0).toFixed(2) + '%'"></span>
                                </div>
                            </div>

                            <div class="mt-4 p-2 bg-gray-600 rounded text-xs">
                                <strong>Bet Quality:</strong> <span x-text="analysisResults?.bet_quality || 'POOR'"></span>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Bankroll Management Tab -->
        <div x-show="activeTab === 'bankroll'" class="space-y-6">
            <div class="bg-gray-800 rounded-xl shadow-2xl p-6">
                <h2 class="text-2xl font-bold mb-6 text-center">
                    <i class="fas fa-wallet mr-2 text-green-400"></i>
                    Bankroll Management
                </h2>
                
                <!-- Bankroll Setup -->
                <div class="grid grid-cols-1 md:grid-cols-3 gap-4 mb-6">
                    <div>
                        <label class="block text-sm font-medium text-gray-300 mb-2">Total Bankroll ($)</label>
                        <input type="number" 
                               x-model="bankrollAmount" 
                               class="w-full p-3 bg-gray-700 border border-gray-600 rounded-lg focus:outline-none focus:ring-2 focus:ring-green-500 text-white" 
                               placeholder="1000">
                    </div>
                    <div>
                        <label class="block text-sm font-medium text-gray-300 mb-2">Unit Size ($)</label>
                        <input type="number" 
                               x-model="unitSize" 
                               class="w-full p-3 bg-gray-700 border border-gray-600 rounded-lg focus:outline-none focus:ring-2 focus:ring-green-500 text-white" 
                               placeholder="Auto (1%)">
                    </div>
                    <div>
                        <label class="block text-sm font-medium text-gray-300 mb-2">Risk Tolerance</label>
                        <select x-model="riskTolerance" class="w-full p-3 bg-gray-700 border border-gray-600 rounded-lg focus:outline-none focus:ring-2 focus:ring-green-500 text-white">
                            <option value="Conservative">Conservative</option>
                            <option value="Medium">Medium</option>
                            <option value="Aggressive">Aggressive</option>
                        </select>
                    </div>
                </div>

                <div class="text-center mb-6">
                    <button @click="initializeBankroll()" 
                            class="bg-green-600 hover:bg-green-700 text-white font-bold py-2 px-6 rounded-lg">
                        Initialize/Update Bankroll
                    </button>
                </div>

                <!-- Bankroll Dashboard -->
                <div x-show="bankrollDashboard" class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4">
                    <div class="bg-gray-700 p-4 rounded-lg text-center">
                        <div class="text-2xl font-bold text-green-400" x-text="'$' + (bankrollDashboard?.bankroll_info?.total_bankroll || 0)"></div>
                        <div class="text-sm text-gray-400">Total Bankroll</div>
                    </div>
                    <div class="bg-gray-700 p-4 rounded-lg text-center">
                        <div class="text-2xl font-bold text-blue-400" x-text="(bankrollDashboard?.performance_metrics?.win_rate || 0) + '%'"></div>
                        <div class="text-sm text-gray-400">Win Rate</div>
                    </div>
                    <div class="bg-gray-700 p-4 rounded-lg text-center">
                        <div class="text-2xl font-bold" :class="(bankrollDashboard?.performance_metrics?.total_profit || 0) >= 0 ? 'text-green-400' : 'text-red-400'" 
                             x-text="'$' + (bankrollDashboard?.performance_metrics?.total_profit || 0)"></div>
                        <div class="text-sm text-gray-400">Total Profit</div>
                    </div>
                    <div class="bg-gray-700 p-4 rounded-lg text-center">
                        <div class="text-2xl font-bold" :class="(bankrollDashboard?.performance_metrics?.roi || 0) >= 0 ? 'text-green-400' : 'text-red-400'" 
                             x-text="(bankrollDashboard?.performance_metrics?.roi || 0) + '%'"></div>
                        <div class="text-sm text-gray-400">ROI</div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Parlay Optimizer Tab -->
        <div x-show="activeTab === 'parlay'" class="space-y-6">
            <div class="bg-gray-800 rounded-xl shadow-2xl p-6">
                <h2 class="text-2xl font-bold mb-6 text-center">
                    <i class="fas fa-layer-group mr-2 text-purple-400"></i>
                    Parlay Optimizer
                </h2>
                
                <div class="text-center">
                    <p class="text-gray-400 mb-4">Add multiple props to find optimal parlay combinations</p>
                    <button @click="addPropToParlay()" 
                            class="bg-purple-600 hover:bg-purple-700 text-white font-bold py-2 px-6 rounded-lg mb-4">
                        <i class="fas fa-plus mr-2"></i>Add Prop to Parlay
                    </button>
                </div>

                <!-- Parlay Props List -->
                <div x-show="parlayProps.length > 0" class="space-y-4">
                    <h4 class="font-semibold">Current Parlay Props:</h4>
                    <template x-for="(prop, index) in parlayProps" :key="index">
                        <div class="bg-gray-700 p-4 rounded-lg flex justify-between items-center">
                            <div>
                                <span class="font-semibold" x-text="prop.player_name"></span> - 
                                <span x-text="prop.prop_type + ' ' + prop.line"></span>
                            </div>
                            <button @click="parlayProps.splice(index, 1)" class="text-red-400 hover:text-red-300">
                                <i class="fas fa-trash"></i>
                            </button>
                        </div>
                    </template>
                    
                    <div class="text-center">
                        <button @click="optimizeParlays()" 
                                :disabled="parlayProps.length < 2"
                                :class="{'opacity-50 cursor-not-allowed': parlayProps.length < 2}"
                                class="bg-gradient-to-r from-purple-600 to-pink-600 hover:from-purple-700 hover:to-pink-700 text-white font-bold py-3 px-8 rounded-lg">
                            <i class="fas fa-magic mr-2"></i>
                            Find Optimal Parlays
                        </button>
                    </div>
                </div>
            </div>
        </div>

        <!-- Analytics Tab -->
        <div x-show="activeTab === 'analytics'" class="space-y-6">
            <div class="bg-gray-800 rounded-xl shadow-2xl p-6">
                <h2 class="text-2xl font-bold mb-6 text-center">
                    <i class="fas fa-chart-bar mr-2 text-yellow-400"></i>
                    Performance Analytics
                </h2>
                
                <div class="grid grid-cols-1 lg:grid-cols-2 gap-6">
                    <!-- Performance Chart Placeholder -->
                    <div class="bg-gray-700 rounded-lg p-4 h-64 flex items-center justify-center">
                        <div class="text-center text-gray-400">
                            <i class="fas fa-chart-line text-4xl mb-2"></i>
                            <p>Performance Chart</p>
                            <p class="text-sm">(Chart.js integration)</p>
                        </div>
                    </div>
                    
                    <!-- Analytics Summary -->
                    <div class="space-y-4">
                        <div class="bg-gray-700 rounded-lg p-4">
                            <h4 class="font-semibold mb-2">Recent Performance (30 days)</h4>
                            <div class="space-y-2 text-sm">
                                <div class="flex justify-between">
                                    <span>Total Bets:</span>
                                    <span x-text="performanceData?.total_bets || 0"></span>
                                </div>
                                <div class="flex justify-between">
                                    <span>Win Rate:</span>
                                    <span x-text="(performanceData?.win_rate || 0) + '%'"></span>
                                </div>
                                <div class="flex justify-between">
                                    <span>Average Profit per Bet:</span>
                                    <span x-text="'$' + (performanceData?.average_profit_per_bet || 0).toFixed(2)"></span>
                                </div>
                                <div class="flex justify-between">
                                    <span>Sharpe Ratio:</span>
                                    <span x-text="(performanceData?.sharpe_ratio || 0).toFixed(2)"></span>
                                </div>
                            </div>
                        </div>
                        
                        <button @click="loadPerformanceAnalytics()" 
                                class="w-full bg-yellow-600 hover:bg-yellow-700 text-white font-bold py-2 px-4 rounded-lg">
                            <i class="fas fa-sync mr-2"></i>Refresh Analytics
                        </button>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Loading Modal -->
    <div x-show="isLoading" class="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50">
        <div class="bg-gray-800 p-6 rounded-lg">
            <i class="fas fa-spinner fa-spin text-2xl text-blue-400 mb-2"></i>
            <p class="text-white">Loading...</p>
        </div>
    </div>

    <script>
        function nbaPropsApp() {
            return {
                activeTab: 'analyzer',
                
                // Analyzer State
                playerSearch: '',
                playerSuggestions: [],
                selectedPlayer: null,
                selectedPropType: '',
                propLine: '',
                opponentTeamId: '',
                includeSituational: true,
                isAnalyzing: false,
                analysisResults: null,
                
                // Bankroll State
                bankrollAmount: 1000,
                unitSize: null,
                riskTolerance: 'Medium',
                bankrollDashboard: null,
                
                // Parlay State
                parlayProps: [],
                
                // Analytics State
                performanceData: null,
                
                // Global State
                isLoading: false,
                
                init() {
                    this.loadBankrollDashboard();
                    this.loadPerformanceAnalytics();
                },
                
                async searchPlayers() {
                    if (this.playerSearch.length < 2) {
                        this.playerSuggestions = [];
                        return;
                    }
                    
                    try {
                        const response = await fetch(`/search_players?q=${encodeURIComponent(this.playerSearch)}`);
                        const data = await response.json();
                        this.playerSuggestions = data || [];
                    } catch (error) {
                        console.error('Error searching players:', error);
                        this.playerSuggestions = [];
                    }
                },
                
                selectPlayer(player) {
                    this.selectedPlayer = player;
                    this.playerSearch = player.full_name;
                    this.playerSuggestions = [];
                },
                
                async analyzeProp() {
                    this.isAnalyzing = true;
                    this.analysisResults = null;
                    
                    try {
                        const response = await fetch('/analyze_prop', {
                            method: 'POST',
                            headers: { 'Content-Type': 'application/json' },
                            body: JSON.stringify({
                                player_id: this.selectedPlayer.id,
                                player_name: this.selectedPlayer.full_name,
                                prop_type: this.selectedPropType,
                                line: parseFloat(this.propLine),
                                opponent_team_id: parseInt(this.opponentTeamId),
                                include_situational: this.includeSituational
                            })
                        });
                        
                        const data = await response.json();
                        if (data.success) {
                            this.analysisResults = data;
                        } else {
                            alert('Error analyzing prop: ' + (data.error || 'Unknown error'));
                        }
                    } catch (error) {
                        console.error('Error analyzing prop:', error);
                        alert('Error analyzing prop: ' + error.message);
                    } finally {
                        this.isAnalyzing = false;
                    }
                },
                
                async initializeBankroll() {
                    try {
                        const response = await fetch('/bankroll/initialize', {
                            method: 'POST',
                            headers: { 'Content-Type': 'application/json' },
                            body: JSON.stringify({
                                bankroll_amount: this.bankrollAmount,
                                unit_size: this.unitSize,
                                risk_tolerance: this.riskTolerance
                            })
                        });
                        
                        const data = await response.json();
                        if (data.success) {
                            this.loadBankrollDashboard();
                            alert('Bankroll initialized successfully!');
                        } else {
                            alert('Error initializing bankroll: ' + (data.error || 'Unknown error'));
                        }
                    } catch (error) {
                        console.error('Error initializing bankroll:', error);
                        alert('Error initializing bankroll: ' + error.message);
                    }
                },
                
                async loadBankrollDashboard() {
                    try {
                        const response = await fetch('/bankroll/dashboard');
                        const data = await response.json();
                        if (!data.error) {
                            this.bankrollDashboard = data;
                        }
                    } catch (error) {
                        console.error('Error loading bankroll dashboard:', error);
                    }
                },
                
                async loadPerformanceAnalytics() {
                    try {
                        const response = await fetch('/analytics/performance');
                        const data = await response.json();
                        if (data.success) {
                            this.performanceData = data.performance;
                        }
                    } catch (error) {
                        console.error('Error loading performance analytics:', error);
                    }
                },
                
                addPropToParlay() {
                    if (!this.analysisResults || !this.analysisResults.success) {
                        alert('Please analyze a prop first');
                        return;
                    }
                    
                    const prop = {
                        player_id: this.selectedPlayer.id,
                        player_name: this.selectedPlayer.full_name,
                        prop_type: this.selectedPropType,
                        line: parseFloat(this.propLine),
                        opponent_team_id: parseInt(this.opponentTeamId),
                        over_probability: this.analysisResults.over_probability,
                        confidence_score: this.analysisResults.confidence_score,
                        edge: this.analysisResults.edge,
                        recommendation: this.analysisResults.recommendation
                    };
                    
                    this.parlayProps.push(prop);
                },
                
                async optimizeParlays() {
                    if (this.parlayProps.length < 2) {
                        alert('Need at least 2 props for parlay optimization');
                        return;
                    }
                    
                    try {
                        const response = await fetch('/parlay/optimize', {
                            method: 'POST',
                            headers: { 'Content-Type': 'application/json' },
                            body: JSON.stringify({
                                props: this.parlayProps,
                                max_legs: 4,
                                min_ev: 0.03
                            })
                        });
                        
                        const data = await response.json();
                        console.log('Parlay optimization result:', data);
                        // TODO: Display parlay results
                    } catch (error) {
                        console.error('Error optimizing parlays:', error);
                    }
                },
                
                // Helper methods for styling
                getConfidenceColor(confidence) {
                    if (confidence >= 80) return 'text-green-400';
                    if (confidence >= 60) return 'text-yellow-400';
                    return 'text-red-400';
                },
                
                getRecommendationColor(recommendation) {
                    if (!recommendation) return 'bg-gray-600';
                    if (recommendation.includes('STRONG')) return 'bg-green-600';
                    if (recommendation.includes('OVER') || recommendation.includes('UNDER')) return 'bg-blue-600';
                    if (recommendation.includes('LEAN')) return 'bg-yellow-600';
                    return 'bg-gray-600';
                },
                
                getRiskColor(riskLevel) {
                    if (riskLevel === 'LOW') return 'text-green-400';
                    if (riskLevel === 'MEDIUM') return 'text-yellow-400';
                    return 'text-red-400';
                }
            }
        }
    </script>
</body>
</html>